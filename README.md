# Local Markdown Viewer - Chrome拡張機能

ローカルのMarkdownファイル（.md, .markdown）をGitHubスタイルで美しくプレビュー表示するChrome拡張機能です。

## 対応言語

この拡張機能は以下の言語に対応しています：

- 🇺🇸 **英語** (en) - English (デフォルト言語)
- 🇯🇵 **日本語** (ja)
- 🇨🇳 **中国語簡体字** (zh_CN) - 简体中文

UIの言語は、Chromeブラウザの言語設定に基づいて自動的に選択されます。

### 言語設定の変更方法

1. Chromeの設定を開く（`chrome://settings/languages`）
2. 「言語」セクションで希望の言語を一番上に移動
3. Chromeを再起動

## 機能

- ✅ **GitHub Flavored Markdown (GFM)** 対応
  - テーブル
  - タスクリスト
  - 打ち消し線
  - 自動リンク
- ✅ **シンタックスハイライト** - 140+のプログラミング言語に対応
- ✅ **Mermaidダイアグラム対応** - フローチャート、シーケンス図、ガントチャート、円グラフなど
- ✅ **数式対応（KaTeX）** - インライン数式とディスプレイ数式をサポート
- ✅ **自動目次（TOC）生成** - 見出し（h1-h6）から自動生成
- ✅ **ダークモード対応** - ワンクリックでライト/ダークモードを切り替え
- ✅ **HTMLエクスポート機能** - スタンドアロンHTMLとして保存（ローカル画像も埋め込み）
- ✅ **印刷機能** - ワンクリックで印刷ダイアログを開く
- ✅ **GitHubスタイル** - GitHubと同じデザインで表示
- ✅ **ローカルファイル対応** - file:// プロトコルでアクセスする.mdファイルに対応

## インストール方法

Chrome Web Storeからインストールします。

インストール後、必ず以下の設定を行ってください：

1. `chrome://extensions/` を開く
2. 「Local Markdown Viewer」拡張機能の「詳細」をクリック
3. **「ファイルのURLへのアクセスを許可する」をONにする**

この設定を有効にしないと、ローカルファイルを表示できません。

## 使用方法

1. ローカルの.mdまたは.markdownファイルをChromeで開く
   - ファイルをChromeのウィンドウにドラッグ&ドロップ
   - または右クリック → 「プログラムから開く」→「Google Chrome」
2. 自動的にGitHubスタイルでプレビュー表示されます

### 右上のボタン操作

右上には4つのボタンが配置されています（左から右へ）：

- **⬇️ ボタン**: HTMLエクスポート
  - ワンクリックでスタンドアロンHTMLファイルとしてダウンロード
  - 画像（ローカル・リモート）を自動的にBase64として埋め込み（並列処理で高速化）
  - エクスポートされたHTMLは、どこに移動しても単体で動作する
- **🖨️ ボタン**: 印刷
  - ワンクリックで印刷ダイアログを開く
  - 印刷時は目次とボタンが非表示になり、コンテンツのみ印刷される
  - 現在のモード（ライト/ダーク）のまま印刷される
- **TeX ボタン**: KaTeX数式レンダリングの切り替え
  - **ON** (デフォルト): `$...$`や`$$...$$`を数式として表示
  - **OFF**: `$`記号をそのまま表示（数式を使わないMarkdownファイル向け）
- **☀️/🌙 ボタン**: ダークモード/ライトモードの表示と切り替え
  - **☀️ 表示**: 現在ライトモード（クリックでダークモードに切り替え）
  - **🌙 表示**: 現在ダークモード（クリックでライトモードに切り替え）

## 機能詳細

### 左サイドバー目次
- 見出しから自動生成される目次が左側に固定表示
- スクロールしても常に表示
- クリックで該当箇所にジャンプ
- サイドバー幅のリサイズに対応（境界線をドラッグ）
- リサイズした幅はlocalStorageに保存され、次回も同じ幅で表示
- レスポンシブ対応（小さい画面では非表示）

### HTMLエクスポート機能

右上の⬇️ボタンをクリックすると、現在表示しているMarkdownを完全なスタンドアロンHTMLファイルとしてエクスポートできます。

**💡 こんな時に便利：**
- **資料共有に最適** - この拡張機能をインストールしていない人にも、見やすい状態でMarkdown資料を共有できます
- **社内ドキュメントの配布** - 技術文書やマニュアルを、HTMLファイル1つで配布可能
- **プレゼン資料のバックアップ** - GitHubスタイルの美しいレイアウトで保存

エクスポートされたHTMLファイルは、拡張機能なしでどのブラウザでも開けるため、チーム全体での情報共有がスムーズになります。

#### エクスポートされるHTMLの特徴

- **単一ファイル**: すべての機能が1つのHTMLファイルに含まれる
- **オフライン対応**:
  - ✅ **画像**: 完全オフライン（Base64埋め込み、並列処理で高速化）
  - ✅ **Mermaid SVG**: 完全オフライン（エクスポート時のSVGを保存）
  - ⚠️ **KaTeX数式**: ほぼオフライン（CSSを埋め込み、フォントのみCDN推奨）
  - ⚠️ **Mermaid.js**: オンライン推奨（ダイアグラムがある場合のみCDNから読み込んで再描画）
- **画像の自動埋め込み**:
  - ローカル画像（`file://`、相対パス）→ Base64化（上限30MB/ファイル）
  - リモート画像（`http://`, `https://`）→ Base64化（上限20MB/ファイル、超過時はURLのまま）
  - サポート形式：PNG, JPEG, GIF, WebP, SVG, BMP
  - **並列処理**: すべての画像を同時ダウンロード・変換（高速化、重複除外）
- **含まれる機能**:
  - ✅ 目次（TOC）とリサイズ機能
  - ✅ ダークモード切り替え（初期値：ライト）
  - ✅ 印刷機能
  - ✅ Mermaidダイアグラム（オンライン時: 再描画、オフライン時: 保存済みSVGを表示）
  - ✅ シンタックスハイライト（既に適用済み）
  - ✅ KaTeX数式（既にレンダリング済み、CSSは埋め込み）
  - ❌ KaTeX切り替えボタン（含まれません）
  - ❌ エクスポートボタン（含まれません）

#### 使用例

1. Markdownファイルを開く
2. 必要に応じてダークモード、KaTeX設定を調整
3. ⬇️ボタンをクリック
4. `ファイル名.html`がダウンロードされる
5. HTMLファイルをどこにでも移動・共有できる

#### 注意事項

- **オフライン表示**:
  - ✅ **画像**: 完全オフライン（ローカル・リモート共にBase64埋め込み）
  - ✅ **Mermaidダイアグラム**: 完全オフライン（エクスポート時のSVGを保存）
  - ⚠️ **KaTeX数式**: ほぼオフライン（CSSを埋め込み、フォントのみCDN推奨）
  - ⚠️ **Mermaid再描画**: オンライン時のみ（ダイアグラムがある場合のみCDNから読み込み）
- **推奨環境**: インターネット接続がある環境（KaTeXフォント、Mermaid再描画で最高品質）
- 画像が多い場合、HTMLファイルサイズが大きくなる可能性があります（ローカル画像: 最大30MB/ファイル、リモート画像: 最大20MB/ファイル）
- 20MBを超えるリモート画像はURLのまま保持されるため、画像の元サーバーが利用可能である必要があります

## サポートされるMarkdown構文

### 基本構文
- 見出し（h1-h6）
- 段落
- 強調（太字、斜体）
- リスト（番号付き、箇条書き）
- リンク
- 画像
- 引用
- コードブロック
- 水平線

### GitHub Flavored Markdown (GFM)

#### テーブル
```markdown
| ヘッダー1 | ヘッダー2 |
|----------|----------|
| セル1    | セル2    |
```

#### タスクリスト
```markdown
- [x] 完了したタスク
- [ ] 未完了のタスク
```

#### シンタックスハイライト

コードブロックに言語を指定すると、自動的にシンタックスハイライトが適用されます：

\`\`\`javascript
function hello() {
  console.log("Hello, World!");
}
\`\`\`

#### Mermaidダイアグラム

コードブロックの言語として`mermaid`を指定すると、ダイアグラムが自動的に描画されます：

\`\`\`mermaid
graph TD
    A[開始] --> B{条件分岐}
    B -->|Yes| C[処理1]
    B -->|No| D[処理2]
    C --> E[終了]
    D --> E
\`\`\`

対応するダイアグラムの種類：
- フローチャート（graph, flowchart）
- シーケンス図（sequenceDiagram）
- クラス図（classDiagram）
- 状態遷移図（stateDiagram）
- ガントチャート（gantt）
- 円グラフ（pie）
- ER図（erDiagram）
- ユーザージャーニー（journey）
- その他多数

**注意**: Mermaidダイアグラムは常にデフォルト（ライト）テーマで描画されます。ダークモード切り替え時も、ダイアグラムは白背景で表示されます（周囲のMarkdownコンテンツのみダークモードになります）。

詳細は[Mermaid公式ドキュメント](https://mermaid.js.org/)をご覧ください。

#### 数式（KaTeX）

LaTeX形式の数式を記述できます：

**インライン数式**（文中に埋め込む）:
```markdown
次の式 $E = mc^2$ はアインシュタインの有名な式です。
または \(E = mc^2\) のように記述することもできます。
```

**ディスプレイ数式**（独立した行として表示）:
```markdown
$$
\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$

または

\[
\sum_{n=1}^{\infty} \frac{1}{n^2} = \frac{\pi^2}{6}
\]
```

対応する記法：
- インライン数式: `$...$` または `\(...\)`
- ディスプレイ数式: `$$...$$` または `\[...\]`

**注意**: 数式レンダリングはデフォルトでONになっています。`$`記号を通常の文字として使用したい場合は、右上の「TeX: ON」ボタンをクリックして「TeX: OFF」に切り替えてください。

詳細は[KaTeX公式ドキュメント](https://katex.org/)をご覧ください。

## トラブルシューティング

### Markdownファイルが正しく表示されない

1. 拡張機能が有効になっているか確認（`chrome://extensions/`）
2. **「ファイルのURLへのアクセスを許可する」がONになっているか確認**（最も重要）
3. ファイル拡張子が`.md`または`.markdown`であることを確認
4. ページをリロード（Ctrl+R または F5）

### 数式が正しく表示されない

1. 右上の「TeX: ON/OFF」ボタンがONになっているか確認
2. 数式の記法が正しいか確認（`$...$`, `$$...$$`, `\(...\)`, `\[...\]`）
3. コンソールにエラーメッセージがないか確認（F12でDevToolsを開く）

## 使用ライブラリ

この拡張機能は以下のオープンソースライブラリを使用しています：

- [marked.js](https://marked.js.org/) v17.0.0 - MIT License
- [highlight.js](https://highlightjs.org/) v11.11.1 - BSD 3-Clause License
- [DOMPurify](https://github.com/cure53/DOMPurify) v3.3.0 - Apache License 2.0 / MPL 2.0
- [Mermaid](https://mermaid.js.org/) v11.12.1 - MIT License
- [KaTeX](https://katex.org/) v0.16.25 - MIT License
- [js-beautify](https://beautifier.io/) v1.15.4 - MIT License

詳細なライセンス情報は [THIRD_PARTY_LICENSES.md](THIRD_PARTY_LICENSES.md) をご覧ください。

**注意**: エクスポート機能では、必要な場合のみ以下のように対応します（自動検出）：
- **KaTeX CSS**: 数式が存在する場合のみCSSを埋め込み（フォントはCDN: cdn.jsdelivr.netから読み込み）
- **Mermaid.js**: Mermaidダイアグラムが存在する場合のみCDNから読み込み（オンライン時のみ再描画）

## ライセンス

このプロジェクトはMITライセンスのもとで公開されています。
